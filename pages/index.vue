<template lang="pug">
div(class="section-wrapper")
  div
    v-img(src="https://www.ec-nordbund.de/wp-content/uploads/bg_pic-5.jpg" :max-height="$vuetify.breakpoint.mdAndUp ? 420 : undefined" height="auto" width="auto" min-width="100%" :min-height="$vuetify.breakpoint.smAndDown ? 'calc(100vh + 3.492vw - 96px)' : undefined" class="secondary align-end angle--bottom-right" gradient="180deg, rgba(0,0,0,0.16) 0%, rgba(0,0,0,0.02) 16%, rgba(0,0,0,0.02) 80%, rgba(0,0,0,0.48) 100%")
      v-container(class="countdown pb-0 pb-md-1")
        v-row(justify="center" no-gutters)
          v-col(cols="12" md="7")
            v-card(class="px-3 ec-gradient text-center pt-4 pb-8" tile)
              span(class="text-h6 pb-5 white--text") Die Anmeldephase beginnt in:
              ec-countdown(target="2020-11-08 15:00:00" keep-zeros)
                template(v-slot:digits="slotProp")
                  span(slot="digits" class="text-h4 font-weight-bold white--text") {{slotProp.digits}}
                template(v-slot:units="slotProp")
                  span(slot="units" class="text-caption text-uppercase white--text") {{slotProp.unit}}
  div(class="angle--bottom-right offWhite")
    v-container(class="mb-4")
      .d-flex.flex-row.justify-space-between.align-end
        h2#aktuelles Aktuelles
        v-btn(text depressed tile large to="/blog/" aria-label="Mehr Beiträge anzeigen")
          span.hidden-xs-only Mehr Beiträge
          v-icon.ml-1.mr-n1 mdi-arrow-right
      v-row(class="mb-4")
        v-col(
          cols='12',
          sm='6',
          md='4',
          v-for='item in pages.recentPosts',
          :key='item.slug'
        )
          v-card(
            tile,
            hover,
            outlined,
            :to='`/blog/${item.slug}`'
          )
            ec-image-item(
              :image='item.featuredImage',
              :title='item.title',
              :subTitle='`Vom ${item.published.split("T")[0].split("-").reverse().join(".")}`'
            )
      .d-flex.flex-row.justify-space-between.align-end
        h2(id='nächste-veranstaltungen') Nächste Veranstaltungen
        v-btn(
          text,
          depressed,
          tile,
          large,
          to="/veranstaltungen/"
          aria-label="Mehr Veranstaltungen anzeigen"
        )
          span.hidden-xs-only Mehr Veranstaltungen
          v-icon.ml-1.mr-n1 mdi-arrow-right
      v-row(class="mb-4")
        v-col(
          cols='12',
          sm='6',
          md='4',
          v-for='item in pages.upcomingEvents',
          :key='item.slug'
        )
          v-card(
            tile,
            hover,
            outlined,
            :to='`/veranstaltungen/${item.slug}`'
          )
            ec-image-item(
              :image="item.featuredImage.split('.')[0] + (supportWebp() ? '.webp' : '.jpg')",
              :title='item.title',
              :subTitle='`Vom ${item.begin.split("-").reverse().join(".")} bis ${item.ende.split("-").reverse().join(".")}`'
            )
  div(class="angle--both-left-right grey lighten-4")
    v-container
      h2(id='über-uns') Über uns
      //- p 
        | Der EC-Nordbund ist einer von 18 Landesverbänden des Deutschen EC-Verbandes.
        | EC bedeutet: „Entschieden für Christus“ und markiert die grundsätzlich evangelische Ausrichtung aller Aktivitäten.
        | Im EC-Nordbund sind alle EC-Kinder- und Jugendarbeiten aus Schleswig-Holstein und Hamburg.
      p
        | Die EC-Arbeit in Deutschland hat den Auftrag,
        | junge Menschen zu Jüngern zu machen
        | und sie zu prägenden Persönlichkeiten heranzubilden,
        | durch die wiederum Menschen ihrer Generation
        | zu Jüngern werden.
      p
        | Der EC-Nordbund ist einer der 18 Landesverbänden des Deutschen EC-Verbandes. Im EC-Nordbund sind alle EC-Kinder- und Jugendarbeiten aus Schleswig-Holstein und Hamburg vereint.
      p
        | EC bedeutet: „Entschieden für Christus“ und markiert die Aurichtung auf Jesus in allen unseren Aktivitäten.
      p
        | Der EC-Nordbund arbeitet eng mit dem Verband der Gemeinschaften in der Evangelischen Kirche in Schleswig-Holstein e.V. (kurz VG) zusammen. Wir betreiben gemeinsam das Erholungs- und Bildungszentrum Wittensee (kurz EBZ) und unser Ferienlager in Karlsminde (bei Eckernförde).
      p
        | Der EC-Nordbund basiert als Gemeinnütziger Verein auf Ehrenamt wir haben nur 2 Hauptamtliche Mitarbeiter. 
      v-row
        v-col(align="center")
          v-img(:src="require('~/assets/img/thomas_seeger.jpg')" :width="128" :height="128" class="hexagon-shape")
          div(class="text-h6") Thomas Seeger
          | Jugendreferent
        v-col(align="center")
          v-img(:src="require('~/assets/img/dortje_gaertner.jpg')" :width="128" :height="128" class="hexagon-shape")
          div(class="text-h6") Dortje Gaertner
          | Kinder- und Jungschararbeit
</template>
<style lang="scss" scoped>
.section-wrapper > div:last-child {
  &.angle--bottom-left,
  &.angle--bottom-right,
  &.angle--both-right-right,
  &.angle--both-left-right,
  &.angle--both-right-left,
  &.angle--both-left-left {
    margin-bottom: -3.492vw;
  }
}

.countdown {
  margin-bottom: -3.493vw;

  .v-sheet {
    box-shadow: 0px 3px 1px -2px rgba(0, 0, 0, 0.2),
      0px 2px 2px 0px rgba(0, 0, 0, 0.14),
      0px 1px 5px 0px rgba(0, 0, 0, 0.12),
      0 11px 15px -7px rgba(0, 0, 0, 0.2),
      0 24px 38px 3px rgba(0, 0, 0, 0.14),
      0 9px 46px 8px rgba(0, 0, 0, 0.12) !important;
  }
}

.hexagon-shape {
  clip-path: polygon(50% 100%, 5% 75%, 5% 25%, 50% 0%, 95% 25%, 95% 75%);
}
</style>
<script>
import { defineComponent, useContext, useAsync } from '@nuxtjs/composition-api'
import { supportWebp } from "../helpers/webp";
export default defineComponent({
  setup() {
    const { $content } = useContext()

    const pages = useAsync(async () => {
      const upcomingEvents = await $content('veranstaltung')
        .only(['slug', 'title', 'begin', 'ende', 'featuredImage', 'tags'])
        .sortBy('begin') // TODO: compare to today's date
        .limit(3)
        .fetch()

      const recentPosts = await $content('blog')
        .only([
          'title',
          'tags',
          'description',
          'featuredImage',
          'slug',
          'published',
        ])
        .sortBy('published', 'desc')
        .limit(3)
        .fetch()

      return { upcomingEvents, recentPosts }
    })

    return { pages, supportWebp }
  },
  head: {
    title: 'Startseite',
    meta: [
      {
        hid: 'description',
        name: 'description',
        content: 'Wir sind der Nordbund!',
      },
      // Open Graph
      { hid: 'og:title', property: 'og:title', content: 'Veranstaltungen' },
      {
        hid: 'og:description',
        property: 'og:description',
        content: 'Wir sind der Nordbund!',
      },
      // Twitter Card
      {
        hid: 'twitter:title',
        name: 'twitter:title',
        content: 'Veranstaltungen',
      },
      {
        hid: 'twitter:description',
        name: 'twitter:description',
        content: 'Wir sind der Nordbund!',
      },
    ],
  },
})
</script>
